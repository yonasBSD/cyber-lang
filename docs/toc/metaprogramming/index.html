<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Metaprogramming. # Operator overloading. # All operators are implemented as object methods.
Incomplete: Not all operators have transitioned to the method paradigm.
Normally this would impact performance, but Cyber&rsquo;s compiler generates specialized bytecode ops for builtin types like int and float. The VM performs inline caching at runtime to eliminate the overhead of evaluating operators on dynamic operands.
To overload an operator for a object type, declare $prefix, $infix, $postfix methods:"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content="Metaprogramming"><meta property="og:description" content="Metaprogramming. # Operator overloading. # All operators are implemented as object methods.
Incomplete: Not all operators have transitioned to the method paradigm.
Normally this would impact performance, but Cyber&rsquo;s compiler generates specialized bytecode ops for builtin types like int and float. The VM performs inline caching at runtime to eliminate the overhead of evaluating operators on dynamic operands.
To overload an operator for a object type, declare $prefix, $infix, $postfix methods:"><meta property="og:type" content="article"><meta property="og:url" content="https://fubark.github.io/cyber/docs/toc/metaprogramming/"><meta property="article:section" content="docs"><title>Metaprogramming | Cyber Docs v0.2</title><link rel=manifest href=/cyber/manifest.json><link rel=icon href=/cyber/favicon.png><link rel=stylesheet href=/cyber/book.min.4f0117e74e5337280f18eb9641eae520cb4b25adcf5dd64fafad4664145a5957.css integrity="sha256-TwEX505TNygPGOuWQerlIMtLJa3PXdZPr61GZBRaWVc=" crossorigin=anonymous><script defer src=/cyber/flexsearch.min.js></script>
<script defer src=/cyber/en.search.min.db402b8c46fe1829b7c32e1613e5e896d742a3010e5975362d629f119703c98d.js integrity="sha256-20ArjEb+GCm3wy4WE+XoltdCowEOWXU2LWKfEZcDyY0=" crossorigin=anonymous></script>
<link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel=stylesheet><link rel=stylesheet href=/cyber/hljs.min.css><link rel=stylesheet href=/cyber/style.css></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/cyber/><span>Cyber Docs v0.2</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://cyberscript.dev target=_blank rel=noopener>Homepage</a></li><li><a href=https://cyberscript.dev/play.html target=_blank rel=noopener>Playground</a></li></ul><ul><li class=book-section-flat><span>Table of Contents</span><ul><li><a href=/cyber/docs/toc/syntax/>Syntax</a></li><li><a href=/cyber/docs/toc/data-types/>Data Types</a></li><li><a href=/cyber/docs/toc/control-flow/>Control Flow</a></li><li><a href=/cyber/docs/toc/functions/>Functions</a></li><li><a href=/cyber/docs/toc/modules/>Modules</a></li><li><a href=/cyber/docs/toc/ffi/>FFI</a></li><li><a href=/cyber/docs/toc/errors/>Error Handling</a></li><li><a href=/cyber/docs/toc/concurrency/>Concurrency</a></li><li><a href=/cyber/docs/toc/type-system/>Type System</a></li><li><a href=/cyber/docs/toc/metaprogramming/ class=active>Metaprogramming</a></li><li><a href=/cyber/docs/toc/embedding/>Embedding</a></li><li><a href=/cyber/docs/toc/memory/>Memory</a></li><li><a href=/cyber/docs/toc/aot-jit/>AOT/JIT</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/cyber/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Metaprogramming</strong>
<label for=toc-control><img src=/cyber/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#operator-overloading>Operator overloading.</a></li><li><a href=#custom-operators>Custom operators.</a></li><li><a href=#magic-functions>Magic functions.</a><ul><li><a href=#call-module>Call module.</a></li><li><a href=#gettersetter>Getter/Setter.</a></li><li><a href=#missing-method>Missing method.</a></li></ul></li><li><a href=#reflection>Reflection.</a><ul><li><a href=#type-metatype><code>type metatype</code></a></li></ul></li><li><a href=#annotations>Annotations.</a></li><li><a href=#runtime-eval>Runtime eval.</a></li><li><a href=#generics>Generics.</a></li><li><a href=#compile-time>Compile-time.</a></li></ul></nav></aside></header><article class=markdown><h1 id=metaprogramming>Metaprogramming.
<a class=anchor href=#metaprogramming>#</a></h1><h2 id=operator-overloading>Operator overloading.
<a class=anchor href=#operator-overloading>#</a></h2><p>All operators are implemented as object methods.</p><blockquote><p><em>Incomplete: Not all operators have transitioned to the method paradigm.</em></p></blockquote><p>Normally this would impact performance, but Cyber&rsquo;s compiler generates specialized bytecode ops for builtin types like <code>int</code> and <code>float</code>. The VM performs inline caching at runtime to eliminate the overhead of evaluating operators on dynamic operands.</p><p>To overload an operator for a object type, declare <code>$prefix</code>, <code>$infix</code>, <code>$postfix</code> methods:</p><blockquote><p><em>Incomplete: Although operator overloading is supported in the VM and builtin types use it, it is not currently enabled for user types.</em></p></blockquote><pre tabindex=0><code class=language-cy data-lang=cy>type Vec2 object:
  x float
  y float

  func $infix+(self, o):
    return Vec2{
      x: x + o.x,
      y: y + o.y,
    }

  func $prefix-(self):
    return Vec2{ x: -x, y: -y }

var a = Vec2{ x: 1, y: 2}
var b = a + Vec2{ x: 3, y: 4 }
var c = -a
</code></pre><p>Some special operators have their own name:</p><pre tabindex=0><code class=language-cy data-lang=cy>type MyCollection object:
  arr List

  func $index(self, idx):
    return arr[idx * 2]

  func $setIndex(self, idx, val):
    arr[idx * 2] = val 

var a = MyCollection{ arr: [1, 2, 3, 4] }
print a[1]        -- Prints `3`
</code></pre><p>A list of all supported operators:</p><ul><li><code>$prefix~(_)</code></li><li><code>$prefix-(_)</code></li><li><code>$infix>(_, _)</code></li><li><code>$infix>=(_, _)</code></li><li><code>$infix&lt;(_, _)</code></li><li><code>$infix&lt;=(_, _)</code></li><li><code>$infix+(_, _)</code></li><li><code>$infix-(_, _)</code></li><li><code>$infix*(_, _)</code></li><li><code>$infix/(_, _)</code></li><li><code>$infix%(_, _)</code></li><li><code>$infix^(_, _)</code></li><li><code>$infix&(_, _)</code></li><li><code>$infix|(_, _)</code></li><li><code>$infix||(_, _)</code></li><li><code>$infix&lt;&lt;(_, _)</code></li><li><code>$infix>>(_, _)</code></li><li><code>$index(_, _)</code></li><li><code>$setIndex(_, _, _)</code></li><li><code>$slice(_, _, _)</code></li></ul><h2 id=custom-operators>Custom operators.
<a class=anchor href=#custom-operators>#</a></h2><blockquote><p><em>Planned Feature</em></p></blockquote><h2 id=magic-functions>Magic functions.
<a class=anchor href=#magic-functions>#</a></h2><h3 id=call-module>Call module.
<a class=anchor href=#call-module>#</a></h3><p>Declare a <code>$call</code> function to allow invoking a module as a function.</p><blockquote><p><em>Incomplete: Although $call function is supported in the VM and builtin modules use it, it is not currently enabled for user modules.</em></p></blockquote><pre tabindex=0><code class=language-cy data-lang=cy>-- Object types are also modules.
type Vec2 object:
  x float
  y float

  func $call(x float, y float) Vec2:
    return Vec2{ x: x, y: y }

var v = Vec2(1, 2)
</code></pre><h3 id=gettersetter>Getter/Setter.
<a class=anchor href=#gettersetter>#</a></h3><blockquote><p><em>Planned Feature</em></p></blockquote><h3 id=missing-method>Missing method.
<a class=anchor href=#missing-method>#</a></h3><p>Declare a <code>$missing</code> method as a fallback when a method was not found in an instance.</p><blockquote><p><em>Planned Feature</em></p></blockquote><pre tabindex=0><code class=language-cy data-lang=cy>type A object:
  func $missing(self, args...):
    return args.len

var a = A{};
print a.foo()      -- Output: &#39;0&#39;
print a.bar(1, 2)  -- Output: &#39;2&#39;
</code></pre><h2 id=reflection>Reflection.
<a class=anchor href=#reflection>#</a></h2><p>A <code>metatype</code> object references an internal type. Use the <code>typeof</code> builtin to get the <code>metatype</code> of a value.</p><pre tabindex=0><code class=language-cy data-lang=cy>var val = 123
print typeof(val)   -- &#39;type: float&#39;

-- Referencing a type as a value also returns its `metatype`.
print boolean       -- &#39;type: boolean&#39;
</code></pre><h3 id=type-metatype><code>type metatype</code>
<a class=anchor href=#type-metatype>#</a></h3><pre tabindex=0><code class=language-cy data-lang=cy>func id(self) int
-- Returns the type ID as an `int`.
</code></pre><h2 id=annotations>Annotations.
<a class=anchor href=#annotations>#</a></h2><blockquote><p><em>Planned Feature</em></p></blockquote><h2 id=runtime-eval>Runtime eval.
<a class=anchor href=#runtime-eval>#</a></h2><blockquote><p><em>Planned Feature</em></p></blockquote><h2 id=generics>Generics.
<a class=anchor href=#generics>#</a></h2><blockquote><p><em>Planned Feature</em></p></blockquote><h2 id=compile-time>Compile-time.
<a class=anchor href=#compile-time>#</a></h2><blockquote><p><em>Planned Feature</em></p></blockquote></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/fubark/cyber/edit/master/docs/hugo/content/docs/toc/metaprogramming.md target=_blank rel=noopener><img src=/cyber/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#operator-overloading>Operator overloading.</a></li><li><a href=#custom-operators>Custom operators.</a></li><li><a href=#magic-functions>Magic functions.</a><ul><li><a href=#call-module>Call module.</a></li><li><a href=#gettersetter>Getter/Setter.</a></li><li><a href=#missing-method>Missing method.</a></li></ul></li><li><a href=#reflection>Reflection.</a><ul><li><a href=#type-metatype><code>type metatype</code></a></li></ul></li><li><a href=#annotations>Annotations.</a></li><li><a href=#runtime-eval>Runtime eval.</a></li><li><a href=#generics>Generics.</a></li><li><a href=#compile-time>Compile-time.</a></li></ul></nav></div></aside></main><script src=/cyber/highlight.min.js></script>
<script>hljs.registerLanguage("cy",function(){return{keywords:{keyword:["func","import","for","coinit","coresume","coyield","return","if","then","else","as","each","while","var","object","break","continue","match","pass","or","and","not","is","some","error","static","capture","true","false","none","throw","try","catch","recover","enum","type"],type:["float","string","bool","any","int","List","Map","rawstring","symbol","pointer"]},contains:[{scope:"string",begin:"'",end:"'"},{scope:"symbol",begin:"#",end:/\w(?=[^\w])/},hljs.COMMENT("--",`
`,{contains:[]}),hljs.C_NUMBER_MODE]}}),hljs.highlightAll()</script></body></html>